# Module Proxy Configuration
quarkus.application.name=module-proxy

# Production port allocation
quarkus.http.port=39005
quarkus.http.host=0.0.0.0
quarkus.grpc.server.use-separate-server=false

# Development override
%dev.quarkus.http.port=39005
%dev.quarkus.http.host=0.0.0.0

# gRPC Client pointing to registration service via Stork/Consul
quarkus.grpc.clients.registration-service.host=registration-service
quarkus.grpc.clients.registration-service.name-resolver=stork

# Stork service discovery configuration
quarkus.stork.registration-service.service-discovery.type=consul
quarkus.stork.registration-service.service-discovery.consul-host=${CONSUL_HOST:consul}
quarkus.stork.registration-service.service-discovery.consul-port=${CONSUL_PORT:8500}

# Development override - use localhost Consul in dev mode
%dev.quarkus.stork.registration-service.service-discovery.consul-host=localhost

# Module Registration Configuration
module.registration.enabled=true
module.registration.module-name=proxy
module.registration.host=${MODULE_PROXY_HOST:host.docker.internal}
module.registration.port=${quarkus.http.port}
module.registration.description=Proxy service for deploying pipeline modules in any language via gRPC
module.registration.capabilities=proxy,grpc-proxy,multilang-support
module.registration.tags=proxy,module,grpc,multilang

# Disable for tests
%test.module.registration.enabled=false

# Module configuration
module.name=proxy
module.type=proxy
module.description=Proxy service for deploying pipeline modules in any language

# Enable gRPC reflection service for production (enabled by default in dev)
quarkus.grpc.server.enable-reflection-service=true

# Health check configuration - use localhost for local development
module.health.check.host=localhost

# Enable OpenAPI and Swagger UI
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui

# gRPC Message Size Configuration (2GB - 1 byte, max int value)
quarkus.grpc.server.max-inbound-message-size=2147483647
quarkus.grpc.clients."*".max-inbound-message-size=2147483647

# Logging Configuration - reduce noise
quarkus.log.level=INFO
quarkus.log.category."ai.pipestream".level=DEBUG
quarkus.log.category."io.vertx.ext.consul".level=WARN
quarkus.log.category."io.quarkus.grpc".level=WARN

# JVM Memory settings for large message processing
quarkus.native.additional-build-args=-J-Xmx4g
%dev.quarkus.devservices.timeout=120s

# Test settings
%test.quarkus.http.port=0

# Compose Dev Services - Use shared dev services via extension
%dev.quarkus.compose.devservices.enabled=true
%dev.quarkus.compose.devservices.files=${user.home}/.pipeline/compose-devservices.yml
%dev.quarkus.compose.devservices.project-name=pipeline-shared-devservices
%dev.quarkus.compose.devservices.start-services=true
%dev.quarkus.compose.devservices.stop-services=false
%dev.quarkus.compose.devservices.reuse-project-for-tests=true

# Test profile uses isolated compose stack
%test.quarkus.compose.devservices.files=src/test/resources/compose-test-services.yml
%test.quarkus.compose.devservices.start-services=true
%test.quarkus.compose.devservices.project-name=pipeline-test-services
%test.quarkus.compose.devservices.stop-services=false
%test.quarkus.compose.devservices.reuse-project-for-tests=true

# Dev Services - Keep enabled for fallback, but compose services take precedence
# Kafka devservices disabled since compose provides Kafka
%dev.quarkus.kafka.devservices.enabled=false

# OpenTelemetry Configuration
quarkus.opentelemetry.enabled=true
quarkus.opentelemetry.tracer.exporter.otlp.endpoint=http://localhost:4317

# Security Configuration
quarkus.security.users.file.enabled=true
quarkus.security.users.file.users=users.properties
quarkus.security.users.file.roles=roles.properties

# HTTP Basic Auth
quarkus.http.auth.basic=true
quarkus.http.auth.basic.realm=PipeStepProcessor
quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# Micrometer Configuration
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.system.enabled=true
quarkus.micrometer.binder.jvm.enabled=true